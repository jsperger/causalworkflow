---
output: github_document
---

<!-- badges: start -->
[![R build status](https://github.com/tidymodels/causalworkflows/workflows/R-CMD-check/badge.svg)](https://github.com/tidymodels/causalworkflows/actions)
<!-- badges: end -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## causalworkflows: A Framework for Staged Causal Estimation

`causalworkflows` is an R package for estimating causal effects using multi-stage, modular modeling procedures that align with the `tidymodels` framework. The package provides a flexible structure for defining and fitting causal estimators that rely on nuisance models, such as the propensity score and outcome models.

The core of the package is the `causal_workflow()` object, which allows you to specify separate `tidymodels` workflows for each component of your estimator. The package then uses cross-fitting to construct robust estimates of causal effects, such as the Average Treatment Effect (ATE), using estimators like the Augmented Inverse Propensity Weighting (AIPW) estimator.

### Installation

You can install the development version of `causalworkflows` from GitHub with:

```{r, eval = FALSE}
# install.packages("pak")
pak::pak("tidymodels/causalworkflows")
```

### Example

The process of defining and fitting a causal workflow involves a few key steps:

1.  **Define Nuisance Models**: Create `workflow` objects for the propensity score model (the probability of receiving treatment) and the outcome model (the expected outcome given treatment and covariates).
2.  **Create a `causal_workflow`**: Initialize a `causal_workflow` object and add the two nuisance models.
3.  **Fit the Workflow**: Use the `fit()` function on the `causal_workflow` object with your dataset. This performs a cross-fitted estimation of the potential outcomes.
4.  **Predict Causal Effects**: Use `predict()` on the fitted object to obtain estimates of the ATE or other causal quantities.

Here is a conceptual example of the API:

```{r, eval = FALSE}
library(causalworkflows)
library(parsnip)
library(recipes)
library(workflows)

# 1. Define nuisance model workflows
# Propensity score model: T ~ X1 + X2
ps_mod <- logistic_reg() |> set_engine("glm")
ps_wflow <-
  workflow() |>
  add_model(ps_mod) |>
  add_formula(treatment ~ V1 + V2 + V3 + V4)

# Outcome model: Y ~ A + X1 + X2
outcome_mod <- linear_reg() |> set_engine("lm")
outcome_wflow <-
  workflow() |>
  add_model(outcome_mod) |>
  add_formula(outcome ~ treatment + V1 + V2 + V3 + V4)

# 2. Create a causal_workflow
causal_wflow <-
  causal_workflow(
    propensity_model = ps_wflow,
    outcome_model = outcome_wflow
  )

# 3. Fit the workflow using cross-fitting
# (assuming 'my_data' is a data frame with treatment, outcome, and covariates)
fitted_wflow <- fit(causal_wflow, data = my_data)

# 4. Get potential outcome estimates
predict(fitted_wflow, type = "potential_outcome")

# Get ATE relative to a reference level
predict(fitted_wflow, type = "blip_ref", ref_level = "control")
```

### Contributing

This project is released with a [Contributor Code of Conduct](https://github.com/tidymodels/causalworkflows/blob/main/.github/CODE_OF_CONDUCT.md). By contributing to this project, you agree to abide by its terms.

- For questions and discussions about tidymodels packages, modeling, and machine learning, please [post on Posit Community](https://forum.posit.co/new-topic?category_id=15&tags=tidymodels,question).

- If you think you have encountered a bug, please [submit an issue](https://github.com/tidymodels/causalworkflows/issues).

- Either way, learn how to create and share a [reprex](https://reprex.tidyverse.org/articles/learn-reprex.html) (a minimal, reproducible example), to clearly communicate about your code.

- Check out further details on [contributing guidelines for tidymodels packages](https://www.tidymodels.org/contribute/) and [how to get help](https://www.tidymodels.org/help/).
