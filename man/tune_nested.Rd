% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tune-nested.R
\name{tune_nested}
\alias{tune_nested}
\title{Tune and estimate a causal workflow with nested resampling}
\usage{
tune_nested(object, ...)
}
\arguments{
\item{object}{A \code{\link[=causal_workflow]{causal_workflow()}} object.}

\item{...}{Additional arguments passed to the underlying tuning or fitting
functions.}

\item{resamples}{An \link{{.pkg rsample}} object for the outer folds of nested
resampling, such as one created by \link[{.fn rsample:vfold_cv}]{{.fn rsample::vfold_cv}}.}

\item{inner_resamples}{An \link{{.pkg rsample}} object for the inner folds, which will
be created from the analysis set of each outer fold.}
}
\value{
A \code{fitted_causal_workflow} object, similar to \code{\link[=fit_across]{fit_across()}}, but
where the nuisance predictions are generated from models that have been
tuned or ensembled within the nested resampling procedure.
}
\description{
\code{\link[=tune_nested]{tune_nested()}} for a \code{\link[=causal_workflow]{causal_workflow()}} object performs nested resampling to
either tune the hyperparameters of the nuisance models or to fit an ensemble
of models using \link{{.pkg stacks}}. It provides robust, unbiased causal effect
estimates for complex, regularized, or non-parametric models that require
tuning.
}
\details{
Nested resampling is essential when a modeling process involves both
hyperparameter tuning and estimation of a final causal effect. It consists
of two loops:
\itemize{
\item An \strong{outer loop} that splits the data into folds for final estimation.
The models are never trained on the assessment sets of these folds,
ensuring the final estimates are unbiased.
\item An \strong{inner loop} that uses the analysis sets from the outer loop to
perform hyperparameter tuning or ensemble fitting.
}

This function handles two main scenarios:
\enumerate{
\item When a component (propensity or outcome model) is a single \code{\link[workflows:workflow]{workflows::workflow()}}
with tunable hyperparameters, \code{tune_nested()} uses the inner resamples
to run \link[{.fn tune:tune_grid}]{{.fn tune::tune_grid}} to find the best hyperparameter combination.
\item When a component is a \code{\link[workflowsets:workflow_set]{workflowsets::workflow_set()}}, \code{tune_nested()} uses the inner
resamples to fit an ensemble using the \link{{.pkg stacks}} package. It trains each
candidate model in the set, blends their predictions into a stacked
ensemble, and fits the final members.
}

The best-performing model or the fitted ensemble from the inner loop is then
used to generate out-of-sample predictions for the outer loop's assessment
set. These predictions are used to calculate the final, doubly robust causal
effect estimates.
}
